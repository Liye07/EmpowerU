@model Business

@{
    ViewBag.Title = "Manage Appointments";
    var pastAppointments = ViewBag.PastAppointments as List<Appointment>;
    var upcomingAppointments = ViewBag.UpcomingAppointments as List<Appointment>;
}

<div class="container mt-4">
    <!-- Filters & Search -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="h4 mb-3">Manage Appointments</h2>
        </div>
        <div class="tab-buttons mb-4">
            <button id="past-btn" class="btn btn-secondary" onclick="showPastAppointments()">Past</button>
            <button id="upcoming-btn" class="btn btn-primary active" onclick="showUpcomingAppointments()">Upcoming</button>
        </div>
        <div class="col-md-4 text-right">
            <input type="text" class="form-control" placeholder="Search by name or service..." />
        </div>
    </div>

    <!-- Appointments Section -->
    <section class="row">
        <!-- Appointments Table -->
        <div class="col-md-8">
            <table id="upcoming-appointments-table" class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Full Name</th>
                        <th>Service</th>
                        <th>Date & Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var appointment in upcomingAppointments)
                    {
                        <tr onclick="showAppointmentDetails(@appointment.AppointmentID,'@appointment.Consumer.Name','@appointment.Consumer.Email','@appointment.Consumer.PhoneNumber','@appointment.ServiceType','@appointment.DateTime.ToString("dd MMM yyyy, hh:mm tt")','@appointment.Status')">
                            <td>@appointment.AppointmentID</td>
                            <td>@appointment.Consumer.Name</td>
                            <td>@appointment.ServiceType</td>
                            <td>@appointment.DateTime.ToString("dd MMM yyyy, hh:mm tt")</td>
                            <td>
                                <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                        appointment.Status == "Pending" ? "bg-warning" :
                                                        appointment.Status == "Scheduled" ? "bg-primary" :
                                                        appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                    @appointment.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <table id="past-appointments-table" class="table table-bordered table-hover" style="display:none;">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Name</th>
                        <th>Date & Time</th>
                        <th>Service Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var appointment in pastAppointments)
                    {
                        <tr onclick="showAppointmentDetails(@appointment.AppointmentID,'@appointment.Consumer.Name','@appointment.Consumer.Email','@appointment.Consumer.PhoneNumber','@appointment.ServiceType','@appointment.DateTime.ToString("dd MMM yyyy, hh:mm tt")','@appointment.Status')">
                            <td>@appointment.AppointmentID</td>
                            <td>@appointment.Consumer.Name</td>
                            <td>@appointment.ServiceType</td>
                            <td>@appointment.DateTime.ToString("dd MMM yyyy, hh:mm tt")</td>
                            <td>
                                <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                appointment.Status == "Pending" ? "bg-warning" :
                                appointment.Status == "Scheduled" ? "bg-primary" :
                                appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                    @appointment.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Appointment Details Section -->
        <div class="col-md-4">
            <h2 class="h5 mb-3">Appointment Details</h2>
            <div id="appointmentDetails" class="card p-3 mb-3" style="display: none;">
                <p><strong>Appointment ID:</strong> <span id="appointmentId"></span></p>
                <p><strong>Full Name:</strong> <span id="appointmentName"></span></p>
                <p><strong>Email:</strong> <span id="appointmentEmail"></span></p>
                <p><strong>Phone:</strong> <span id="appointmentPhone"></span></p>
                <p><strong>Service:</strong> <span id="appointmentService"></span></p>
                <p><strong>Date & Time:</strong> <span id="appointmentDateTime"></span></p>
                <p>
                    <strong>Status:</strong>
                    <span id="appointmentStatus" class="badge"></span>
                </p>
                <button class="btn btn-primary mt-2">Reschedule</button>
                <button class="btn btn-danger mt-2">Cancel</button>
            </div>
            <div id="noAppointmentSelected" class="alert alert-info" style="display: block;">
                No appointment selected.
            </div>
        </div>
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

    function showPastAppointments() {
        document.getElementById('upcoming-appointments-table').style.display = 'none';
        document.getElementById('past-appointments-table').style.display = 'table';
        document.getElementById('past-btn').classList.add('active');
        document.getElementById('upcoming-btn').classList.remove('active');
    }

    function showUpcomingAppointments() {
        document.getElementById('upcoming-appointments-table').style.display = 'table';
        document.getElementById('past-appointments-table').style.display = 'none';
        document.getElementById('past-btn').classList.remove('active');
        document.getElementById('upcoming-btn').classList.add('active');
    }

    function showAppointmentDetails(id, name, email, phone, service, dateTime, status) {
        document.getElementById("appointmentId").innerText = id;
        document.getElementById("appointmentName").innerText = name;
        document.getElementById("appointmentEmail").innerText = email;
        document.getElementById("appointmentPhone").innerText = phone;
        document.getElementById("appointmentService").innerText = service;
        document.getElementById("appointmentDateTime").innerText = dateTime;

        var statusBadge = document.getElementById("appointmentStatus");
        statusBadge.innerText = status;
        statusBadge.className = "badge " + (status === "Completed" ? "bg-success" :
            status === "Pending" ? "bg-warning" :
                status === "Scheduled" ? "bg-primary" :
                    status === "Cancelled" ? "bg-danger" : "bg-secondary");

        document.getElementById("appointmentDetails").style.display = "block";
        document.getElementById("noAppointmentSelected").style.display = "none";
    }

    function rescheduleAppointment(appointmentID) {
        alert('Reschedule feature is under construction for Appointment ID: ' + appointmentID);
    }

    function cancelAppointment(appointmentID) {
        if (confirm('Are you sure you want to cancel this appointment?')) {
            alert('Appointment ID ' + appointmentID + ' has been canceled.');
        }
    }
</script>
<style>
    .table-hover tbody tr:hover {
        background-color: #f0f8ff; /* Light blue background on hover */
    }

    
    .appointment-details {
        display: none; /* Initially hidden */
    }

    .table td, .table th {
        white-space: nowrap; /* Prevent text wrapping */
    }
</style>

@model Business

@{
    ViewBag.Title = "Manage Appointments";
    var business = ViewBag.Business as Business;
    var appointments = ViewBag.Appointments as List<Appointment>;
}

<div class="container mt-4">
    <!-- Filters & Search -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="h4 mb-3">Manage Appointments</h2>
        </div>
        <div class="col-md-4 text-right">
            <input type="text" class="form-control" placeholder="Search by name or service..." />
        </div>
    </div>

    <!-- Appointments Section -->
    <section class="row">
        <!-- Appointments Table -->
        <div class="col-md-8">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Full Name</th>
                        <th>Service</th>
                        <th>Date & Time</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (appointments != null && appointments.Any())
                    {
                        foreach (var appointment in appointments)
                        {
                            <tr onclick="showAppointmentDetails(@appointment.AppointmentID)">
                                <td>@appointment.AppointmentID</td>
                                <td>@appointment.Consumer.Name</td>
                                <td>@appointment.ServiceType</td>
                                <td>@appointment.DateTime.ToString("dd MMM yyyy, hh:mm tt")</td>
                                <td>
                                    <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                appointment.Status == "Pending" ? "bg-warning" :
                                                appointment.Status == "Scheduled" ? "bg-primary" :
                                                appointment.Status == "Cancelled" ? "bg-danger" :"bg-secondary")">
                                        @appointment.Status
                                    </span>
                                </td>


                                <td>
                                    <div class="d-flex">
                                        <a href="/Appointments/Details/@appointment.AppointmentID" class="btn btn-sm btn-outline-info me-2">View</a>
                                        <button class="btn btn-sm btn-outline-primary me-2" onclick="rescheduleAppointment(@appointment.AppointmentID)">Reschedule</button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="cancelAppointment(@appointment.AppointmentID)">Cancel</button>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center">No appointments available</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Appointment Details Section -->
        <div class="col-md-4">
            <h2 class="h5 mb-3">Appointment Details</h2>
            <div id="appointmentDetails" class="card p-3 mb-3" style="display: none;">
                <p><strong>Appointment ID:</strong> <span id="appointmentId"></span></p>
                <p><strong>Full Name:</strong> <span id="appointmentName"></span></p>
                <p><strong>Email:</strong> <span id="appointmentEmail"></span></p>
                <p><strong>Phone:</strong> <span id="appointmentPhone"></span></p>
                <p><strong>Service:</strong> <span id="appointmentService"></span></p>
                <p><strong>Date & Time:</strong> <span id="appointmentDateTime"></span></p>
                <p>
                    <strong>Status:</strong>
                    <span id="appointmentStatus" class="badge"></span>
                </p>
            </div>
            <button class="btn btn-primary btn-block" id="editAppointmentButton" style="display: none;">Edit Appointment</button>
            <div id="noAppointmentSelected" class="alert alert-info" style="display: block;">
                No appointment selected.
            </div>
        </div>
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function showAppointmentDetails(id, name, email, phone, service, dateTime, status) {
        document.getElementById("appointmentId").innerText = id;
        document.getElementById("appointmentName").innerText = name;
        document.getElementById("appointmentEmail").innerText = email;
        document.getElementById("appointmentPhone").innerText = phone;
        document.getElementById("appointmentService").innerText = service;
        document.getElementById("appointmentDateTime").innerText = dateTime;

        // Update the status badge
        var statusBadge = document.getElementById("appointmentStatus");
        statusBadge.innerText = status;
        statusBadge.className = "badge " + (status === "Completed" ? "bg-success" :
            status === "Pending" ? "bg-warning" :
                status === "Scheduled" ? "bg-primary" :
                    status === "Cancelled" ? "bg-danger" :
                        "bg-secondary");

        // Show the appointment details card and hide the no appointment message
        document.getElementById("appointmentDetails").style.display = "block";
        document.getElementById("noAppointmentSelected").style.display = "none";
        document.getElementById("editAppointmentButton").style.display = "block"; // Show the edit button
    }

    function rescheduleAppointment(appointmentID) {
        alert('Reschedule feature is under construction for Appointment ID: ' + appointmentID);
    }

    function cancelAppointment(appointmentID) {
        if (confirm('Are you sure you want to cancel this appointment?')) {
            alert('Appointment ID ' + appointmentID + ' has been canceled.');
        }
    }
</script>
<style>
    .table-hover tbody tr:hover {
        background-color: #f0f8ff; /* Light blue background on hover */
    }
</style>

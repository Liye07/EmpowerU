@model Appointment

@{
    ViewData["Title"] = "Appointment Details";
    var pastAppointments = ViewBag.PastAppointments as List<Appointment>;
    var upcomingAppointments = ViewBag.UpcomingAppointments as List<Appointment>;
}

<div class="container mt-4">
    <h2>Appointments</h2>

    <div class="tab-buttons mb-4">
        <button id="past-btn" class="btn btn-secondary" onclick="showPastAppointments()">Past</button>
        <button id="upcoming-btn" class="btn btn-primary active" onclick="showUpcomingAppointments()">Upcoming</button>
    </div>

    <div class="row">
        <div class="col-md-8">
            <table id="upcoming-appointments-table" class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Business Name</th>
                        <th>Service Type</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var appointment in upcomingAppointments)
                    {
                        <tr onclick="showAppointmentDetails(@appointment.AppointmentID)">
                            <td>@appointment.AppointmentID</td>
                            <td>@appointment.Business.Name</td>
                            <td>@appointment.ServiceType</td>
                            <td>@appointment.DateTime.ToLongDateString()</td>
                            <td>
                                <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                        appointment.Status == "Pending" ? "bg-warning" :
                                                        appointment.Status == "Scheduled" ? "bg-primary" :
                                                        appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                    @appointment.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <table id="past-appointments-table" class="table table-bordered table-hover" style="display:none;">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Business Name</th>
                        <th>Date</th>
                        <th>Service Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var appointment in pastAppointments)
                    {
                        <tr onclick="showAppointmentDetails(@appointment.AppointmentID)">
                            <td>@appointment.AppointmentID</td>
                            <td>@appointment.Business.Name</td>
                            <td>@appointment.DateTime.ToLongDateString()</td>
                            <td>@appointment.ServiceType</td>
                            <td>
                                <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                        appointment.Status == "Pending" ? "bg-warning" :
                                                        appointment.Status == "Scheduled" ? "bg-primary" :
                                                        appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                    @appointment.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="col-md-4">
            <h2 class="h5 mb-3">Appointment Details</h2>
            <div id="appointmentDetails" class="card p-3 mb-3" style="display: none;">
                <p><strong>Appointment ID: </strong><span id="detailAppointmentId">@Model.AppointmentID</span></p>
                <p><strong>Business Name: </strong><span id="detailBusinessName">@Model.Business.Name</span></p>
                <p><strong>First Name: </strong><span id="detailFirstName">@Model.Consumer.Name</span></p>
                <p><strong>Surname: </strong><span id="detailSurname">@Model.Consumer.Surname</span></p>
                <p><strong>Email: </strong><span id="detailEmail">@Model.Consumer.Email</span></p>
                <p><strong>Phone No.: </strong><span id="detailPhone">@Model.Consumer.PhoneNumber</span></p>
                <p><strong>Service Type: </strong><span id="detailServiceType">@Model.ServiceType</span></p>
                <p><strong>Date: </strong><span id="detailDate">@Model.DateTime.ToString("g")</span></p>
                <p><strong>Status: </strong><span class="badge" id="detailStatusBadge">@Model.Status</span></p>

                <button class="btn btn-primary mt-2">Leave a Review</button>
                <button class="btn btn-danger mt-2">Pay Now</button>
            </div>
            <div id="noAppointmentSelected" class="alert alert-info" style="display: block;">
                No appointment selected.
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function showPastAppointments() {
        document.getElementById('upcoming-appointments-table').style.display = 'none';
        document.getElementById('past-appointments-table').style.display = 'table';
        document.getElementById('past-btn').classList.add('active');
        document.getElementById('upcoming-btn').classList.remove('active');
    }

    function showUpcomingAppointments() {
        document.getElementById('upcoming-appointments-table').style.display = 'table';
        document.getElementById('past-appointments-table').style.display = 'none';
        document.getElementById('past-btn').classList.remove('active');
        document.getElementById('upcoming-btn').classList.add('active');
    }

    function showAppointmentDetails(appointmentId, businessName, firstName, surname, email, phone, serviceType, date, status) {
        document.getElementById("detailAppointmentId").innerText = appointmentId;
        document.getElementById("detailBusinessName").innerText = businessName;
        document.getElementById("detailFirstName").innerText = firstName;
        document.getElementById("detailSurname").innerText = surname;
        document.getElementById("detailEmail").innerText = email;
        document.getElementById("detailPhone").innerText = phone;
        document.getElementById("detailServiceType").innerText = serviceType;
        document.getElementById("detailDate").innerText = date;

        // Set the status badge
        var statusBadge = document.getElementById("detailStatusBadge");
        statusBadge.innerText = status;
        statusBadge.className = "badge " + (status === "Completed" ? "bg-success" :
            status === "Pending" ? "bg-warning" :
                status === "Scheduled" ? "bg-primary" :
                    status === "Cancelled" ? "bg-danger" : "bg-secondary");

        // Show appointment details
        document.getElementById("appointmentDetails").style.display = "block";
        document.getElementById("noAppointmentSelected").style.display = "none";
    }


</script>

<style>
    .table-hover tbody tr:hover {
        background-color: #f0f8ff; /* Light blue background on hover */
    }

    .appointment-details {
        display: none; /* Initially hidden */
    }

    .table td, .table th {
        white-space: nowrap; /* Prevent text wrapping */
    }
</style>
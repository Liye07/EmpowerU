@model Appointment

@{
    ViewData["Title"] = "Appointment Details";
    var pastAppointments = ViewBag.PastAppointments as List<Appointment>;
    var upcomingAppointments = ViewBag.UpcomingAppointments as List<Appointment>;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/Site.css" rel="stylesheet" />
    <style>
        .appointment-details {
            display: none; /* Initially hidden */
        }

        .table td, .table th {
            white-space: nowrap; /* Prevent text wrapping */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>Appointments</h2>

        <div class="tab-buttons mb-4">
            <button id="past-btn" class="btn btn-secondary" onclick="showPastAppointments()">Past</button>
            <button id="upcoming-btn" class="btn btn-primary active" onclick="showUpcomingAppointments()">Upcoming</button>
        </div>

        <div class="row">
            <div class="col-md-8">
                <table id="upcoming-appointments-table" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Appointment ID</th>
                            <th>Business Name</th>
                            <th>Date</th>
                            <th>Service Type</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var appointment in upcomingAppointments)
                        {
                            <tr onclick="showAppointmentDetails(@appointment.AppointmentID)">
                                <td>@appointment.AppointmentID</td>
                                <td>@appointment.Business.Name</td>
                                <td>@appointment.DateTime.ToShortDateString()</td>
                                <td>@appointment.ServiceType</td>
                                <td>
                                    <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                        appointment.Status == "Pending" ? "bg-warning" :
                                                        appointment.Status == "Scheduled" ? "bg-primary" :
                                                        appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                        @appointment.Status
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

                <table id="past-appointments-table" class="table table-bordered" style="display:none;">
                    <thead>
                        <tr>
                            <th>Appointment ID</th>
                            <th>Business Name</th>
                            <th>Date</th>
                            <th>Service Type</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var appointment in pastAppointments)
                        {
                            <tr onclick="showAppointmentDetails(@appointment.AppointmentID)">
                                <td>@appointment.AppointmentID</td>
                                <td>@appointment.Business.Name</td>
                                <td>@appointment.DateTime.ToShortDateString()</td>
                                <td>@appointment.ServiceType</td>
                                <td>
                                    <span class="badge @(appointment.Status == "Completed" ? "bg-success" :
                                                        appointment.Status == "Pending" ? "bg-warning" :
                                                        appointment.Status == "Scheduled" ? "bg-primary" :
                                                        appointment.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                        @appointment.Status
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="col-md-4">
                 <h2 class="h5 mb-3">Appointment Details</h2>
                <div id="appointmentDetails" class="card p-3 mb-3" style="display: none;">
                    <p><strong>Appointment ID: </strong><span id="detailAppointmentId"></span></p>
                    <p><strong>Business Name: </strong><span id="detailBusinessName"></span></p>
                    <p><strong>First Name: </strong><span id="detailFirstName"></span></p>
                    <p><strong>Surname: </strong><span id="detailSurname"></span></p>
                    <p><strong>Email: </strong><span id="detailEmail"></span></p>
                    <p><strong>Phone No.: </strong><span id="detailPhone"></span></p>
                    <p><strong>Service Type: </strong><span id="detailServiceType"></span></p>
                    <p><strong>Date: </strong><span id="detailDate"></span></p>
                    <p><strong>Status: </strong><span class="badge" id="detailStatusBadge"></span></p>

                    <button class="btn btn-primary mt-2">Leave a Review</button>
                </div>
                <div id="noAppointmentSelected" class="alert alert-info" style="display: block;">
                    No appointment selected.
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showPastAppointments() {
            document.getElementById('upcoming-appointments-table').style.display = 'none';
            document.getElementById('past-appointments-table').style.display = 'table';
            document.getElementById('past-btn').classList.add('active');
            document.getElementById('upcoming-btn').classList.remove('active');
        }

        function showUpcomingAppointments() {
            document.getElementById('upcoming-appointments-table').style.display = 'table';
            document.getElementById('past-appointments-table').style.display = 'none';
            document.getElementById('past-btn').classList.remove('active');
            document.getElementById('upcoming-btn').classList.add('active');
        }

        function showAppointmentDetails(appointmentId) {
            // Fetch appointment details based on appointmentId from your data source
            // For demonstration, I will use dummy data
            var appointment = {
                ID: appointmentId,
                BusinessName: "Business Name Here", // Replace with actual data
                FirstName: "John", // Replace with actual data
                Surname: "Doe", // Replace with actual data
                Email: "john.doe@example.com", // Replace with actual data
                Phone: "123-456-7890", // Replace with actual data
                ServiceType: "Consultation", // Replace with actual data
                Date: "2024-10-20", // Replace with actual data
                Status: "Scheduled" // Replace with actual data
            };

            // Set the details in the corresponding HTML elements
            document.getElementById("detailAppointmentId").innerText = appointment.ID;
            document.getElementById("detailBusinessName").innerText = appointment.BusinessName;
            document.getElementById("detailFirstName").innerText = appointment.FirstName;
            document.getElementById("detailSurname").innerText = appointment.Surname;
            document.getElementById("detailEmail").innerText = appointment.Email;
            document.getElementById("detailPhone").innerText = appointment.Phone;
            document.getElementById("detailServiceType").innerText = appointment.ServiceType;
            document.getElementById("detailDate").innerText = appointment.Date;

            // Set the status badge
            var statusBadge = document.getElementById("detailStatusBadge");
            statusBadge.innerText = appointment.Status;
            statusBadge.className = "badge " + (appointment.Status === "Completed" ? "bg-success" :
                appointment.Status === "Pending" ? "bg-warning" :
                    appointment.Status === "Scheduled" ? "bg-primary" :
                        appointment.Status === "Cancelled" ? "bg-danger" : "bg-secondary");

            // Show appointment details
            document.getElementById("appointmentDetails").style.display = "block";
            document.getElementById("noAppointmentSelected").style.display = "none";
        }
    </script>

    <style>
        .table-hover tbody tr:hover {
            background-color: #f0f8ff; /* Light blue background on hover */
        }
    </style>
</body>
</html>
